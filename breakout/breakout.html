<!DOCTYPE html>
<html>
<head><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /></head>
<style>
  body {
    background-color: white;
    margin: 0;
    padding: 0;
    border: 0;
    height: 100%;
    overflow: hidden;
    touch-action: manipulation;
  }
</style>

<canvas id="gameCanvas" width=window.innerWidth height=window.innerHeight></canvas>

<script>

  var mouseX = window.innerWidth/2
  var framesPerSecond = 60;
  var score = 0;
  var paddle = {width:window.innerWidth/8,height:window.innerHeight/50,widthMax:window.innerWidth/4};
  var colors = ["#2e4053","#7d3c98","#ba4a00","#d4ac0d","#17a589","#2e86c1"];
  var blocks = [];
  var blockData = {height:window.innerHeight/30,width:window.innerWidth/15};
  balls = [];
  powerups = [];

  class ball{
    constructor(xPos,yPos){
      this.xPos = xPos;this.xVel = 0;this.yVel=0;this.moving = false;this.radius = window.innerWidth/150;
      this.yPos = yPos-this.radius;
      this.xVelMax = 6*(1800/window.innerWidth); this.yVelMax = 10*(800/window.innerHeight);
    }
    drawBall(mouseX){
      ctx.fillStyle = "silver";
      ctx.beginPath();
      if(this.moving == false){
        this.xPos = mouseX;
        ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
      }
      else{
        ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
      }
      ctx.fill();
    }
    activateBall(){
      if(this.moving == false){
        this.moving = true;
        this.xVel = 6*Math.random()-3;
        this.yVel = -window.innerHeight/70;
      }
    }
    updateBall(blocks){
      for (var k = 0; k<blocks.length; k++){
        if(blocks[k].checkCollision(this.radius,this.xPos+this.xVel,this.yPos+this.yVel)){
          this.yVel = -this.yVel;
          blocks[k].destroy();
          blocks.splice(k, 1);
          break;
        }
      }
      if(this.yPos > window.innerHeight-window.innerHeight/15 - 10 && this.moving){
        if(this.yPos+this.yVel >= window.innerHeight-window.innerHeight/15 && this.yPos+this.yVel <= window.innerHeight-window.innerHeight/15+2*(window.innerHeight/80) && this.xPos <= mouseX+paddle.width/2 && this.xPos >= mouseX-paddle.width/2){
          var strength = Math.ceil(Math.abs(mouseX-this.xPos)/(window.innerWidth/100));
          this.yVel = -this.yVel*strength;
          this.xVel = this.xVel*strength;
        }
      }
      if(this.xPos < 100){
        if(this.xPos+this.xVel < 0){
          this.xVel = -this.xVel;
        }
      }
      if(this.yPos < 20){
        if(this.yPos+this.yVel < 0){
          this.yVel = -this.yVel;
        }
      }
      if(this.xPos > window.innerWidth - 100){
        if(this.xPos + this.xVel > window.innerWidth){
          this.xVel = -this.xVel;
        }
      }
      if(Math.abs(this.xVel) > this.xVelMax){
        if(this.xVel<0){this.xVel = -this.xVelMax;}
        else{this.xVel = this.xVelMax};
      }
      if(Math.abs(this.yVel) > this.yVelMax){
        if(this.yVel<0){this.yVel = -this.yVelMax;}
        else{this.yVel = this.yVelMax};
      }
      this.yPos += this.yVel;
      this.xPos += this.xVel;
    }
    getYPos(){
      return this.yPos;
    }
  }

  class powerupItem{
    constructor(xPos,yPos,type){
      this.xPos = xPos;this.yPos = yPos;this.yVel = window.innerHeight/240;this.radius = window.innerWidth/100;
      this.type = type;
    }
    checkCollision(mouseX){
      if(this.yPos > window.innerHeight-window.innerHeight/15 - 10){
        if(this.yPos+this.yVel >= window.innerHeight-window.innerHeight/15 && this.yPos+this.yVel <= window.innerHeight-window.innerHeight/15+2*(window.innerHeight/80) && this.xPos <= mouseX+paddle.width/2 && this.xPos >= mouseX-paddle.width/2){
          return [true,this.type];
        }
      }
      return [false,this.type];
    }
    drawPowerupItem(){
      if(this.type == "bonusball"){
        ctx.fillStyle = "gold";
      }
      if(this.type == "long"){
        ctx.fillStyle = "red";
      }
      ctx.beginPath();
      ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
      ctx.fill();
    }
    updatePowerupItem(){
      this.yPos += this.yVel;
    }
  }

  class block{
    constructor(xPos,yPos,color,width,height){
      this.xPos = xPos;this.yPos = yPos;this.color = color;this.width = width; this.height = height;
      this.halfWidth = this.width/2;this.halfHeight = this.height/2;
    }
    drawBlock(){
      ctx.fillStyle = "black";
      ctx.fillRect(this.xPos,this.yPos,this.width,this.height);
      ctx.fillStyle = this.color;
      ctx.fillRect(this.xPos+1,this.yPos+1,this.width-2,this.height-2);
    }
    checkCollision(radius,circleX,circleY){
      var distX = Math.abs(circleX - (this.xPos + this.width / 2));
      var distY = Math.abs(circleY - (this.yPos + this.height / 2));
      if (distX > this.halfWidth + radius || distY > this.halfHeight + radius)
      {return false}
      if (distX <= this.halfWidth || distY <= this.halfHeight)
      {return true}
    }
    destroy(){
      if(Math.random()<0.5){
        if(Math.random()>0.5){
          powerups.push(new powerupItem(this.xPos+this.halfWidth,this.yPos,"bonusball"));
        }
        else{
          powerups.push(new powerupItem(this.xPos+this.halfWidth,this.yPos,"long"));
        }
      }
    }
  }

  window.onload = function() {
    canvas = document.getElementById("gameCanvas");
    ctx = canvas.getContext("2d");
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
    gameSetup();
    gameRender();
    canvas.addEventListener("mousemove",function(evt){calculateMousePos(evt)});
    canvas.addEventListener("touchmove",function(evt){calculateMousePosFromTouch(evt)});
    canvas.addEventListener("click",function(){click();});
    setInterval(update, 1000/framesPerSecond);
  }

  function click(){
    for(var i = 0;i<balls.length;i++){
      balls[i].activateBall();
    }
  }

  function calculateMousePos(evt){
    var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    mouseX = evt.clientX - rect.left - root.scrollLeft;
  }

  function calculateMousePosFromTouch(evt){
    var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    mouseX = evt.changedTouches[0].pageX - rect.left - root.scrollLeft;
  }

  function gameSetup(){
    var blocksNumberAcross = window.innerWidth/(blockData.width);
    var blocksNumberDown = (window.innerHeight/3)/(blockData.height);
    var currentColor;
    for(var j = 0;j<blocksNumberDown;j++){
      for(var i = 0;i<blocksNumberAcross;i++){
        currentColor = colors[Math.floor(Math.random()*colors.length)];
        blocks.push(new block(i*blockData.width,window.innerHeight/20+j*blockData.height,currentColor,blockData.width,blockData.height));
      }
    }
    balls.push(new ball(mouseX-paddle.width/2,window.innerHeight-window.innerHeight/15))
  }

  function update(){
    for(var v =0;v<balls.length;v++){
      balls[v].updateBall(blocks);
      if(balls[v].getYPos() > window.innerHeight){
        balls.splice(v,1);
      }
    }
    for(var v = 0;v<powerups.length;v++){
      powerups[v].updatePowerupItem();
      if(powerups[v].checkCollision(mouseX)[0]){
        if(powerups[v].checkCollision(mouseX)[1] == "bonusball"){
          balls.push(new ball(mouseX-paddle.width/2,window.innerHeight-window.innerHeight/15));
        }
        if(powerups[v].checkCollision(mouseX)[1] == "long"){
          if(paddle.width < paddle.widthMax){
            paddle.width *= 1.07;
          }
        }
        powerups.splice(v,1);
      }
    }
    gameRender();
    if(balls.length == 0){
      blocks = [];
      powerups = [];
      gameSetup();
      gameRender();
    }
  }

  function gameRender(){
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height)
    ctx.fillStyle = "white";
    ctx.fillRect(mouseX-paddle.width/2,window.innerHeight-window.innerHeight/15,paddle.width,paddle.height);
    for(var i = 0;i < blocks.length; i++){
      blocks[i].drawBlock();
    }
    for(var i = 0;i< balls.length; i++){
      balls[i].drawBall(mouseX);
    }
    for(var i = 0;i < powerups.length; i++){
      powerups[i].drawPowerupItem();
    }
  }

</script>

</html>
