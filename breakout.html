<!DOCTYPE html>
<html>
<style>
  body {
    background-color: white;
    margin: 0;
    padding: 0;
    border: 0;
    height: 100%;
    overflow: hidden;
  }
</style>

<canvas id="gameCanvas" width=window.innerWidth height=window.innerHeight></canvas>

<script>

  var mouseX = window.innerWidth/2,mouseY;
  var framesPerSecond = 30;
  var score = 0;
  var paddle = {width:window.innerWidth/12,height:window.innerHeight/80};
  var colors = ["#2e4053","#7d3c98","#ba4a00","#d4ac0d","#17a589","#2e86c1"];
  var blocks = [];
  var blockData = {height:window.innerHeight/40,width:window.innerWidth/30};
  var balls = [];

  class ball{
    constructor(xPos,yPos){
      this.xPos = xPos;this.xVel = 0;this.yVel=0;this.moving = false;this.radius = window.innerWidth/150;
      this.yPos = yPos-this.radius;
    }
    drawBall(mouseX){
      ctx.fillStyle = "silver";
      ctx.beginPath();
      if(this.moving == false){
        this.xPos = mouseX;
        ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
      }
      else{
        ctx.arc(this.xPos, this.yPos, this.radius, 0, 2 * Math.PI);
      }
      ctx.fill();
    }
    activateBall(){
      if(this.moving == false){
        this.moving = true;
        this.xVel = 6*Math.random()-3;
        this.yVel = -window.innerHeight/70;
      }
    }
    updateBall(blocks){
      for(i = 0;i<blocks.length;i++){
        if(blocks[i].checkCollision(this.radius,this.xPos,this.yPos)){
          this.xVel = -this.xVel;
          this.yVel = -this.yVel;
        }
      }
      this.xPos += this.xVel;
      this.yPos += this.yVel;
    }
  }

  class block{
    constructor(xPos,yPos,color,width,height){
      this.xPos = xPos;this.yPos = yPos;this.color = color;this.width = width; this.height = height;
    }
    drawBlock(){
      ctx.fillStyle = "black";
      ctx.fillRect(this.xPos,this.yPos,this.width,this.height);
      ctx.fillStyle = this.color;
      ctx.fillRect(this.xPos+1,this.yPos+1,this.width-2,this.height-2);
    }
    checkCollision(radiussq,circleX,circleY){
      if((this.xPos-circleX) <= radiussq || (this.xPos+this.width-circleX) <= radiussq ||(this.yPos+this.height-circleY) <= radiussq || (this.yPos+this.height-circleY) <= radiussq){
        return true;
      }
      return false;
    }
  }

  window.onload = function() {
    canvas = document.getElementById("gameCanvas");
    ctx = canvas.getContext("2d");
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
    gameSetup();
    gameRender();
    canvas.addEventListener("mousemove",function(evt){calculateMousePos(evt)});
    canvas.addEventListener("click",function(){click();});
    setInterval(update, 1000/framesPerSecond);
  }

  function click(){
    for(i = 0;i<balls.length;i++){
      balls[i].activateBall();
    }
  }

  function calculateMousePos(evt){
    var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    mouseX = evt.clientX - rect.left - root.scrollLeft;
    mouseY = evt.clientY - rect.top - root.scrollTop;
  }

  function gameSetup(){
    var blocksNumberAcross = window.innerWidth/(blockData.width);
    var blocksNumberDown = (window.innerHeight/3)/(blockData.height);
    var currentColor;
    for(j = 0;j<blocksNumberDown;j++){
      for(i = 0;i<blocksNumberAcross;i++){
        currentColor = colors[Math.floor(Math.random()*colors.length)];
        blocks.push(new block(i*blockData.width,window.innerHeight/20+j*blockData.height,currentColor,blockData.width,blockData.height));
      }
    }
    balls.push(new ball(mouseX-paddle.width/2,window.innerHeight-window.innerHeight/15))
  }

  function update(){
    gameRender();
    for(i =0;i<balls.length;i++){
      balls[i].updateBall(blocks);
    }
  }

  function gameRender(){
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height)
    ctx.fillStyle = "white";
    ctx.fillRect(mouseX-paddle.width/2,window.innerHeight-window.innerHeight/15,paddle.width,paddle.height);
    for(i = 0;i < blocks.length; i++){
      blocks[i].drawBlock();
    }
    for(i = 0;i< balls.length; i++){
      balls[i].drawBall(mouseX);
    }
  }



</script>

</html>
